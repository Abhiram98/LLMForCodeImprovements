{
    "Method_Improvements": {
        "Improvements": [
            {
                "Improvement": "Extract repeated ApiResponse objects to method",
                "Change_Diff": "- ApiResponse okSingularResponse=new ApiResponse().description(\"Successful response\").content(new Content().addMediaType(JsonApi.MEDIA_TYPE,new MediaType().schema(new Datum(new Relationship(schemaName)))));\n- ApiResponse okPluralResponse=new ApiResponse().description(\"Successful response\").content(new Content().addMediaType(JsonApi.MEDIA_TYPE,new MediaType().schema(new Data(new Relationship(schemaName)))));\n- ApiResponse okEmptyResponse=new ApiResponse().description(\"Successful response\");\n+ ApiResponse okSingularResponse = createApiResponse(schemaName, true);\n+ ApiResponse okPluralResponse = createApiResponse(schemaName, false);\n+ ApiResponse okEmptyResponse = createEmptyApiResponse();",
                "Description": "The ApiResponse objects are being created multiple times with the same parameters. You can avoid this repetition by extracting them into a separate method. This will make the code cleaner and easier to maintain.",
                "Start": 9,
                "End": 13
            },
            {
                "Improvement": "Extract repeated Operation objects to method",
                "Change_Diff": "- path.get(new Operation().tags(getTags()).description(\"Returns the relationship identifiers for \" + name).responses(new ApiResponses().addApiResponse(\"200\",okPluralResponse)));\n- path.post(new Operation().tags(getTags()).description(\"Adds items to the relationship \" + name).requestBody(new RequestBody().content(new Content().addMediaType(JsonApi.MEDIA_TYPE,new MediaType().schema(new Data(new Relationship(schemaName)))))).responses(new ApiResponses().addApiResponse(\"201\",okPluralResponse)));\n- path.patch(new Operation().tags(getTags()).description(\"Replaces the relationship \" + name).requestBody(new RequestBody().content(new Content().addMediaType(JsonApi.MEDIA_TYPE,new MediaType().schema(new Data(new Relationship(schemaName)))))).responses(new ApiResponses().addApiResponse(\"204\",okEmptyResponse)));\n- path.delete(new Operation().tags(getTags()).description(\"Deletes items from the relationship \" + name).requestBody(new RequestBody().content(new Content().addMediaType(JsonApi.MEDIA_TYPE,new MediaType().schema(new Data(new Relationship(schemaName)))))).responses(new ApiResponses().addApiResponse(\"204\",okEmptyResponse)));\n+ path.get(createOperation(\"Returns the relationship identifiers for \" + name, okPluralResponse));\n+ path.post(createOperation(\"Adds items to the relationship \" + name, okPluralResponse, new RequestBody().content(new Content().addMediaType(JsonApi.MEDIA_TYPE,new MediaType().schema(new Data(new Relationship(schemaName))))), \"201\"));\n+ path.patch(createOperation(\"Replaces the relationship \" + name, okEmptyResponse, new RequestBody().content(new Content().addMediaType(JsonApi.MEDIA_TYPE,new MediaType().schema(new Data(new Relationship(schemaName))))), \"204\"));\n+ path.delete(createOperation(\"Deletes items from the relationship \" + name, okEmptyResponse, new RequestBody().content(new Content().addMediaType(JsonApi.MEDIA_TYPE,new MediaType().schema(new Data(new Relationship(schemaName))))), \"204\"));",
                "Description": "The Operation objects are being created multiple times with similar parameters. You can avoid this repetition by extracting them into a separate method. This will make the code cleaner and easier to maintain.",
                "Start": 18,
                "End": 30
            }
        ],
        "Final code": "public PathItem getRelationshipPath(){\n  if (lineage.isEmpty()) {\n    throw new IllegalStateException(\"Root collections don't have relationships\");\n  }\n  PathItem path=new PathItem();\n  lineage.stream().forEach(item -> path.addParametersItem(item.getPathParameter()));\n  String schemaName=getSchemaName(type);\n  ApiResponse okSingularResponse = createApiResponse(schemaName, true);\n  ApiResponse okPluralResponse = createApiResponse(schemaName, false);\n  ApiResponse okEmptyResponse = createEmptyApiResponse();\n  Type<?> parentClass=lineage.peek().getType();\n  RelationshipType relationshipType=dictionary.getRelationshipType(parentClass,name);\n  if (relationshipType.isToMany()) {\n    if (canRead(parentClass,name) && canRead(type)) {\n      path.get(createOperation(\"Returns the relationship identifiers for \" + name, okPluralResponse));\n    }\n    if (canUpdate(parentClass,name)) {\n      path.post(createOperation(\"Adds items to the relationship \" + name, okPluralResponse, new RequestBody().content(new Content().addMediaType(JsonApi.MEDIA_TYPE,new MediaType().schema(new Data(new Relationship(schemaName))))), \"201\"));\n      path.patch(createOperation(\"Replaces the relationship \" + name, okEmptyResponse, new RequestBody().content(new Content().addMediaType(JsonApi.MEDIA_TYPE,new MediaType().schema(new Data(new Relationship(schemaName))))), \"204\"));\n      path.delete(createOperation(\"Deletes items from the relationship \" + name, okEmptyResponse, new RequestBody().content(new Content().addMediaType(JsonApi.MEDIA_TYPE,new MediaType().schema(new Data(new Relationship(schemaName))))), \"204\"));\n    }\n  }\n else {\n    if (canRead(parentClass,name) && canRead(type)) {\n      path.get(createOperation(\"Returns the relationship identifiers for \" + name, okSingularResponse));\n    }\n    if (canUpdate(parentClass,name)) {\n      path.patch(createOperation(\"Replaces the relationship \" + name, okEmptyResponse, new RequestBody().content(new Content().addMediaType(JsonApi.MEDIA_TYPE,new MediaType().schema(new Datum(new Relationship(schemaName))))), \"204\"));\n    }\n  }\n  if (path.getGet() != null) {\n    for (Parameter param : getFilterParameters()) {\n      path.getGet().addParametersItem(param);\n    }\n    for (Parameter param : getPageParameters()) {\n      path.getGet().addParametersItem(param);\n    }\n  }\n  decorateGlobalResponses(path);\n  decorateGlobalParameters(path);\n  return path;\n}"
    },
    "Old_Method": "/** \n * Returns the OpenAPI path for a relationship URL.\n * @return the OpenAPI 'Path' for a relationship URL(/books/{bookId}/relationships/author).\n * @throws IllegalStateException for errors.\n */\npublic PathItem getRelationshipPath(){\n  if (lineage.isEmpty()) {\n    throw new IllegalStateException(\"Root collections don't have relationships\");\n  }\n  PathItem path=new PathItem();\n  lineage.stream().forEach(item -> path.addParametersItem(item.getPathParameter()));\n  String schemaName=getSchemaName(type);\n  ApiResponse okSingularResponse=new ApiResponse().description(\"Successful response\").content(new Content().addMediaType(JsonApi.MEDIA_TYPE,new MediaType().schema(new Datum(new Relationship(schemaName)))));\n  ApiResponse okPluralResponse=new ApiResponse().description(\"Successful response\").content(new Content().addMediaType(JsonApi.MEDIA_TYPE,new MediaType().schema(new Data(new Relationship(schemaName)))));\n  ApiResponse okEmptyResponse=new ApiResponse().description(\"Successful response\");\n  Type<?> parentClass=lineage.peek().getType();\n  RelationshipType relationshipType=dictionary.getRelationshipType(parentClass,name);\n  if (relationshipType.isToMany()) {\n    if (canRead(parentClass,name) && canRead(type)) {\n      path.get(new Operation().tags(getTags()).description(\"Returns the relationship identifiers for \" + name).responses(new ApiResponses().addApiResponse(\"200\",okPluralResponse)));\n    }\n    if (canUpdate(parentClass,name)) {\n      path.post(new Operation().tags(getTags()).description(\"Adds items to the relationship \" + name).requestBody(new RequestBody().content(new Content().addMediaType(JsonApi.MEDIA_TYPE,new MediaType().schema(new Data(new Relationship(schemaName)))))).responses(new ApiResponses().addApiResponse(\"201\",okPluralResponse)));\n      path.patch(new Operation().tags(getTags()).description(\"Replaces the relationship \" + name).requestBody(new RequestBody().content(new Content().addMediaType(JsonApi.MEDIA_TYPE,new MediaType().schema(new Data(new Relationship(schemaName)))))).responses(new ApiResponses().addApiResponse(\"204\",okEmptyResponse)));\n      path.delete(new Operation().tags(getTags()).description(\"Deletes items from the relationship \" + name).requestBody(new RequestBody().content(new Content().addMediaType(JsonApi.MEDIA_TYPE,new MediaType().schema(new Data(new Relationship(schemaName)))))).responses(new ApiResponses().addApiResponse(\"204\",okEmptyResponse)));\n    }\n  }\n else {\n    if (canRead(parentClass,name) && canRead(type)) {\n      path.get(new Operation().tags(getTags()).description(\"Returns the relationship identifiers for \" + name).responses(new ApiResponses().addApiResponse(\"200\",okSingularResponse)));\n    }\n    if (canUpdate(parentClass,name)) {\n      path.patch(new Operation().tags(getTags()).description(\"Replaces the relationship \" + name).requestBody(new RequestBody().content(new Content().addMediaType(JsonApi.MEDIA_TYPE,new MediaType().schema(new Datum(new Relationship(schemaName)))))).responses(new ApiResponses().addApiResponse(\"204\",okEmptyResponse)));\n    }\n  }\n  if (path.getGet() != null) {\n    for (    Parameter param : getFilterParameters()) {\n      path.getGet().addParametersItem(param);\n    }\n    for (    Parameter param : getPageParameters()) {\n      path.getGet().addParametersItem(param);\n    }\n  }\n  decorateGlobalResponses(path);\n  decorateGlobalParameters(path);\n  return path;\n}\n",
    "File_Path": "elide/elide-swagger/src/main/java/com/yahoo/elide/swagger/OpenApiBuilder.java",
    "Start": 8065,
    "Stop": 12641,
    "Project_Name": "data/projects/elide",
    "Method_Name": "getRelationshipPath"
}